<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Inventory App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        h1 { color: #333; }
        table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
        #error { color: red; margin-top: 1rem; }
    </style>
</head>
<body>
<h1>Inventory â€“ getMajetok</h1>

<!-- Input as buttons only -->
<div>
    <button onclick="openFileDialog()">Load c:/temp/*.csv</button>
    <input type="file" id="csvFile" accept=".csv" style="display:none" />
    <button onclick="loadData('OK')">OK</button>
    <button onclick="loadData('M')">Missing</button>
    <button onclick="loadData('V')">Moved</button>
    <button onclick="loadData('removed')">Removed</button>
</div>

<div id="error"></div>
<table id="inventoryTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Room</th>
        <th>Type</th>
        <th>Price</th>
        <th>In Date</th>
        <th>Out Date</th>
        <th>State</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    async function loadData(state) {
      const tableBody = document.querySelector("#inventoryTable tbody");
      const errorDiv = document.getElementById("error");
      tableBody.innerHTML = "";
      errorDiv.textContent = "";

      try {
        const response = await fetch(`/api/items/state/${state}`);
        if (!response.ok) {
          throw new Error(`Server returned ${response.status}`);
        }
        const data = await response.json();

        if (data.length === 0) {
          errorDiv.textContent = "No items found for this state.";
          return;
        }

        data.forEach(item => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.assetId || ""}</td>
            <td>${item.name || ""}</td>
            <td>${item.room.name || ""}</td>
            <td>${item.type.name || ""}</td>
            <td>${item.price || ""}</td>
            <td>${item.inDate || ""}</td>
            <td>${item.outDate || ""}</td>
            <td>${item.state || ""}</td>
          `;
          tableBody.appendChild(row);
        });
      } catch (err) {
        errorDiv.textContent = "Error: " + err.message;
      }
    }

    // open .csv file from local disk c:/temp/
    function openFileDialog() {
      document.getElementById('csvFile').click();
    }
    document.getElementById('csvFile').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      // browser doesn't give full path, only filename!
      const fileName = file.name;

      fetch(`/api/loadFromFile?path=c:/temp/${fileName}`, { method: 'POST' })
        .then(response => response.text())
        .then(msg => {
          alert("Server response: " + msg);
        })
        .catch(error => {
          alert("Error: " + error);
        });
    });
</script>

</body>
</html>

